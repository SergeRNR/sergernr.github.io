!function(){const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];class s{static getRandomElFromArray(t){return t[Math.round(100*Math.random())%t.length]}}class i{constructor({type:t,rowIndex:e,colIndex:s}){this.type=t,this.rowIndex=e,this.colIndex=s}}var t=new class{constructor(t){this.canvas=new fabric.Canvas(t,{interactive:!1,selection:!1})}onCellClick(s){this.canvas.on("mouse:up",({pointer:t})=>{var e=Math.floor(t.y/100),t=Math.floor(t.x/100);s(e,t)})}clear(){this.canvas.clear()}createLine(t,e){return new fabric.Line(t,{hoverCursor:"default",selectable:!1,stroke:"#fff",strokeWidth:e})}renderGrid(){var t=[[100,0,100,0],[200,0,200,0],[0,100,0,100],[0,200,0,200]].map(t=>this.createLine(t,2));t.forEach(t=>this.canvas.add(t)),t.forEach(t=>t.animate({x2:t.get("x2")||300,y2:t.get("y2")||300},{onChange:this.canvas.renderAll.bind(this.canvas),onComplete:()=>t.setCoords(),duration:300}))}renderCell({type:t,rowIndex:e,colIndex:s}){const i=100*s+20,r=100*e+20;if(t){s=[[i,r,i,r],[i+60,r,i+60,r]].map(t=>this.createLine(t,2));return s.forEach(t=>this.canvas.add(t)),s.forEach((t,e)=>t.animate({x2:e?i:i+60,y2:r+60},{onChange:this.canvas.renderAll.bind(this.canvas),onComplete:()=>t.setCoords(),duration:150})),s}{const a=new fabric.Circle({hoverCursor:"default",left:i,top:r,radius:30,selectable:!1,stroke:"#fff",strokeDashArray:[200,200],strokeDashOffset:200,strokeWidth:2});return this.canvas.add(a),a.animate({strokeDashOffset:0},{onChange:this.canvas.renderAll.bind(this.canvas),onComplete:()=>a.setCoords(),duration:150}),[a]}}renderWinLine(t,e){let s=t%3*100,i=100*Math.floor(t/3),r=e%3*100,a=100*Math.floor(e/3);s===r&&i<a&&(s+=50,r+=50,a+=100),s<r&&i===a&&(r+=100,i+=50,a+=50),s<r&&i<a&&(r+=100,a+=100),s>r&&i<a&&(s+=100,a+=100);const n=this.createLine([s,i,s,i],2);this.canvas.add(n),n.animate({x2:r,y2:a},{onChange:this.canvas.renderAll.bind(this.canvas),onComplete:()=>{n.setCoords(),this.canvas.getObjects().forEach(t=>t.setOptions({stroke:"#aaa"})),n.setOptions({stroke:"#fff"}),this.canvas.renderAll()},duration:200})}}("canvas"),r=new class{constructor(){document.querySelectorAll("[data-bind]").forEach(e=>Object.defineProperty(this,e.dataset.bind,{set(t){e.innerText=t}})),document.querySelectorAll("[data-classname]").forEach(s=>Object.defineProperty(this,s.dataset.classname,{set(e){Object.keys(e).forEach(t=>e[t]?s.classList.add(t):s.classList.remove(t))}})),document.querySelectorAll("[data-click]").forEach(e=>Object.defineProperty(this,e.dataset.click,{set(t){e.addEventListener("click",t)}}))}};new class{constructor(t,e){this.renderer=t,this.renderer.onCellClick(this.onCellClick.bind(this)),this.ui=e,this.ui.restartGame=this.start.bind(this),this.ui.switchMode=this.switchMode.bind(this),this.playVsHuman=!0,this.drawCount=0,this.winCount0=0,this.winCount1=0}gameOver(t){this.gameIsOver=!0,setTimeout(()=>{null===t?(this.drawCount++,this.ui.scoreD=this.drawCount):t?(this.winCount1++,this.ui.scoreX=this.winCount1):(this.winCount0++,this.ui.scoreO=this.winCount0),this.ui.message=null===t?"Draw!":this.playVsHuman?`Player ${t?1:2} wins!`:`${t?"Player":"AI"} wins!`},200)}getNextMove(){var t=e.find(t=>2===t.filter(t=>this.cells[t]&&this.cells[t].type===this.turn).length&&t.some(t=>!this.cells[t]));if(t)return t.find(t=>!this.cells[t]);t=e.find(t=>2===t.filter(t=>this.cells[t]&&1===this.cells[t].type).length&&t.some(t=>!this.cells[t]));if(t)return t.find(t=>!this.cells[t]);if(s.getRandomElFromArray([0,1])){t=[0,2,6,8].filter(t=>!this.cells[t]);if(t.length)return s.getRandomElFromArray(t);if(!this.cells[4])return 4}else{if(!this.cells[4])return 4;t=[0,2,6,8].filter(t=>!this.cells[t]);if(t.length)return s.getRandomElFromArray(t)}t=[1,3,5,7].filter(t=>!this.cells[t]);return t.length?s.getRandomElFromArray(t):void 0}getWin(){return e.find(t=>t.every(t=>this.cells[t]&&this.cells[t].type===this.turn))}makeAiMove(){this.playVsHuman||this.turn||setTimeout(()=>{var t=this.getNextMove(),e=Math.floor(t/3);this.onCellClick(e,t%3)},300)}onCellClick(t,e){var s=3*t+e;if(!this.gameIsOver&&!this.cells[s])return t=new i({type:this.turn,rowIndex:t,colIndex:e}),this.cells[s]=t,this.renderer.renderCell(t),(e=this.getWin())?(this.renderer.renderWinLine(e[0],e[2]),this.gameOver(this.turn)):9===this.cells.filter(Boolean).length?this.gameOver(null):(this.turn=this.turn?0:1,this.updateActiveClass(),void this.makeAiMove())}start(){this.renderer.clear(),this.renderer.renderGrid(),this.ui.message="",this.cells=new Array(9),this.gameIsOver=!1,this.xStarts=!this.xStarts,this.turn=Number(this.xStarts),this.updateActiveClass(),this.makeAiMove()}switchMode(){this.playVsHuman=!this.playVsHuman,this.drawCount=this.ui.scoreD=0,this.winCount0=this.ui.scoreO=0,this.winCount1=this.ui.scoreX=0,this.xStarts=!1,this.start(),this.ui.modeButtonText=this.playVsHuman?"2 players":"1 player",this.ui.playerName=this.playVsHuman?"Player 1 (X)":"Player (X)",this.ui.opponentName=this.playVsHuman?"Player 2 (O)":"AI (O)"}updateActiveClass(){this.ui.classO={active:!this.turn},this.ui.classX={active:!!this.turn}}}(t,r).start()}();
